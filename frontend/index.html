<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>DeepSeek Chat</title>
    <style>
        body { font-family: Arial; background:#111; color:#eee; max-width: 800px; margin: 0 auto; padding: 20px; }
        textarea { width:100%; height:100px; background: #222; color: #fff; border: 1px solid #444; padding: 10px; box-sizing: border-box; }
        button { padding:10px 20px; margin-top:10px; cursor: pointer; background: #007bff; color: white; border: none; border-radius: 4px; }
        button:disabled { background: #555; }
        #output { background:#222; padding:20px; margin-top: 20px; border-radius: 8px; line-height: 1.6; }
        /* Koda bloku stils Markdown saturam */
        pre { background: #333; padding: 10px; overflow-x: auto; border-radius: 4px; }
        code { font-family: 'Courier New', Courier, monospace; }
    </style>
</head>
<body>
    <h1>DeepSeek-Coder Chat</h1>

    <textarea id="input" placeholder="Uzraksti uzdevumu vai jautājumu..."></textarea>
    <br>
    <button onclick="send()">Sūtīt</button>

    <div id="output"></div>

    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>

    <script>
    async function send() {
        const inputField = document.getElementById("input");
        const output = document.getElementById("output");
        const button = document.querySelector("button");
        const message = inputField.value;
        
        if (!message.trim()) return;

        // Sagatavojam saskatni
        output.innerHTML = "<em>Domāju...</em>";
        button.disabled = true;
        let text = "";

        try {
            const res = await fetch("/api/chat", {
                method: "POST",
                headers: {"Content-Type": "application/json"},
                body: JSON.stringify({ message: message })
            });

            if (!res.ok) throw new Error("Servera kļūda");

            const reader = res.body.getReader();
            const decoder = new TextDecoder();
            output.innerHTML = ""; 

            while (true) {
                const { value, done } = await reader.read();
                if (done) break;
                
                text += decoder.decode(value);
                // marked.parse pārvērš Markdown par HTML
                output.innerHTML = marked.parse(text);
                
                // Automātiska skrollēšana
                window.scrollTo(0, document.body.scrollHeight);
            }
        } catch (error) {
            output.innerHTML = `<span style="color:red">Kļūda: ${error.message}</span>`;
        } finally {
            button.disabled = false;
        }
    }
    </script>
</body>
</html>